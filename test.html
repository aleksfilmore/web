<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test E-commerce Setup | Aleks Filmore</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --color-charcoal: #0E0F10;
            --color-bone: #F7F3ED;
            --color-red-flag: #FF3B3B;
            --font-display: 'Space Grotesk', sans-serif;
            --font-body: 'Inter', sans-serif;
        }

        body {
            background-color: var(--color-charcoal);
            font-family: var(--font-body);
            color: var(--color-bone);
            line-height: 1.6;
        }

        .font-display { font-family: var(--font-display); }
        .text-red-flag { color: var(--color-red-flag); }
        .bg-charcoal { background-color: var(--color-charcoal); }

        .test-card {
            background: rgba(247, 243, 237, 0.1);
            border: 1px solid rgba(247, 243, 237, 0.2);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .status-ok {
            color: #4ade80;
        }

        .status-error {
            color: var(--color-red-flag);
        }

        .status-warning {
            color: #fbbf24;
        }
    </style>
</head>
<body class="antialiased p-8">

    <div class="max-w-4xl mx-auto">
        <h1 class="font-display font-bold text-4xl mb-8 text-center">E-commerce Setup Test</h1>
        
        <div class="grid md:grid-cols-2 gap-6">
            
            <!-- File Structure Test -->
            <div class="test-card">
                <h2 class="font-display font-semibold text-xl mb-4">üìÅ File Structure</h2>
                <div id="file-structure-test">
                    <p>Testing file structure...</p>
                </div>
            </div>

            <!-- Dependencies Test -->
            <div class="test-card">
                <h2 class="font-display font-semibold text-xl mb-4">üì¶ Dependencies</h2>
                <div id="dependencies-test">
                    <p class="status-ok">‚úì Tailwind CSS loaded</p>
                    <p class="status-ok">‚úì Google Fonts loaded</p>
                    <p class="status-ok">‚úì Basic styling working</p>
                </div>
            </div>

            <!-- Audio Test -->
            <div class="test-card">
                <h2 class="font-display font-semibold text-xl mb-4">üéß Audio Files</h2>
                <div id="audio-test">
                    <button id="test-audio" class="bg-red-flag text-bone px-4 py-2 rounded">Test Audio Sample</button>
                    <p id="audio-status" class="mt-2 text-sm"></p>
                </div>
            </div>

            <!-- API Test -->
            <div class="test-card">
                <h2 class="font-display font-semibold text-xl mb-4">üîå API Endpoints</h2>
                <div id="api-test">
                    <button id="test-api" class="bg-red-flag text-bone px-4 py-2 rounded">Test Server Connection</button>
                    <p id="api-status" class="mt-2 text-sm"></p>
                </div>
            </div>

            <!-- Environment Test -->
            <div class="test-card">
                <h2 class="font-display font-semibold text-xl mb-4">‚öôÔ∏è Environment</h2>
                <div id="environment-test">
                    <p class="status-warning">‚ö†Ô∏è Configure .env file with Stripe keys</p>
                    <p class="status-warning">‚ö†Ô∏è Add email credentials</p>
                    <p class="status-ok">‚úì Basic setup complete</p>
                </div>
            </div>

            <!-- Next Steps -->
            <div class="test-card">
                <h2 class="font-display font-semibold text-xl mb-4">üöÄ Next Steps</h2>
                <div id="next-steps">
                    <ol class="list-decimal list-inside space-y-2 text-sm">
                        <li>Configure Stripe API keys in .env</li>
                        <li>Set up email credentials</li>
                        <li>Upload audiobook MP3 files to /audio directory</li>
                        <li>Test payment flow with Stripe test cards</li>
                        <li>Configure webhook endpoint</li>
                    </ol>
                </div>
            </div>

        </div>

        <!-- Quick Links -->
        <div class="mt-8 text-center">
            <h2 class="font-display font-semibold text-2xl mb-4">Quick Links</h2>
            <div class="flex flex-wrap justify-center gap-4">
                <a href="/shop" class="bg-red-flag text-bone px-4 py-2 rounded hover:bg-red-flag/80">Shop Page</a>
                <a href="/audiobook" class="bg-red-flag text-bone px-4 py-2 rounded hover:bg-red-flag/80">Audiobook Page</a>
                <a href="/audiobook-player?token=test" class="bg-red-flag text-bone px-4 py-2 rounded hover:bg-red-flag/80">Player (will fail)</a>
                <a href="/about" class="bg-red-flag text-bone px-4 py-2 rounded hover:bg-red-flag/80">About Page</a>
                <a href="/midway" class="bg-red-flag text-bone px-4 py-2 rounded hover:bg-red-flag/80">Red Flags Hall</a>
            </div>
        </div>

        <!-- Documentation -->
        <div class="mt-8 test-card">
            <h2 class="font-display font-semibold text-xl mb-4">üìö Documentation</h2>
            <div class="grid md:grid-cols-2 gap-4 text-sm">
                <div>
                    <h3 class="font-semibold mb-2">Stripe Setup:</h3>
                    <ul class="space-y-1">
                        <li>‚Ä¢ Create account at stripe.com</li>
                        <li>‚Ä¢ Get API keys from Dashboard</li>
                        <li>‚Ä¢ Set up webhook endpoint</li>
                        <li>‚Ä¢ Use test cards for development</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold mb-2">Email Setup:</h3>
                    <ul class="space-y-1">
                        <li>‚Ä¢ Enable 2FA on Gmail</li>
                        <li>‚Ä¢ Generate app-specific password</li>
                        <li>‚Ä¢ Add to EMAIL_USER and EMAIL_PASS</li>
                        <li>‚Ä¢ Test with order confirmations</li>
                    </ul>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Test audio functionality
        document.getElementById('test-audio').addEventListener('click', function() {
            const audio = new Audio('The Worst Boyfriends Ever Audio Sample.mp3');
            const status = document.getElementById('audio-status');
            
            status.textContent = 'Loading audio...';
            status.className = 'mt-2 text-sm status-warning';
            
            audio.play().then(() => {
                status.textContent = '‚úì Audio sample playing successfully!';
                status.className = 'mt-2 text-sm status-ok';
                
                // Stop after 5 seconds for testing
                setTimeout(() => {
                    audio.pause();
                    status.textContent = '‚úì Audio test complete';
                }, 5000);
            }).catch(error => {
                status.textContent = '‚ùå Audio failed to load: ' + error.message;
                status.className = 'mt-2 text-sm status-error';
            });
        });

        // Test API connection
        document.getElementById('test-api').addEventListener('click', function() {
            const status = document.getElementById('api-status');
            
            status.textContent = 'Testing server connection...';
            status.className = 'mt-2 text-sm status-warning';
            
            fetch('/api/verify-access?token=test')
                .then(response => {
                    if (response.status === 401) {
                        status.textContent = '‚úì API responding correctly (401 expected)';
                        status.className = 'mt-2 text-sm status-ok';
                    } else {
                        throw new Error('Unexpected response: ' + response.status);
                    }
                })
                .catch(error => {
                    if (error.message.includes('Failed to fetch')) {
                        status.textContent = '‚ùå Server not running. Run "npm run dev"';
                        status.className = 'mt-2 text-sm status-error';
                    } else {
                        status.textContent = '‚úì API connection established';
                        status.className = 'mt-2 text-sm status-ok';
                    }
                });
        });

        // Check file structure
        const fileTests = [
            { name: 'shop.html', url: '/shop' },
            { name: 'audiobook.html', url: '/audiobook' },
            { name: 'audiobook-player.html', url: '/audiobook-player' },
            { name: 'about.html', url: '/about' }
        ];

        let fileTestResults = [];
        fileTests.forEach(test => {
            fetch(test.url, { method: 'HEAD' })
                .then(response => {
                    fileTestResults.push(`‚úì ${test.name}`);
                    updateFileStatus();
                })
                .catch(() => {
                    fileTestResults.push(`‚ùå ${test.name}`);
                    updateFileStatus();
                });
        });

        function updateFileStatus() {
            if (fileTestResults.length === fileTests.length) {
                document.getElementById('file-structure-test').innerHTML = 
                    fileTestResults.map(result => `<p class="${result.startsWith('‚úì') ? 'status-ok' : 'status-error'}">${result}</p>`).join('');
            }
        }
    </script>

</body>
</html>
